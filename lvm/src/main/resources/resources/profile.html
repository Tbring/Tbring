<!DOCTYPE html>
<html lang="en" xmlns:v-on="http://www.w3.org/1999/xhtml">

<head>
    <!-- basic -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- mobile metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <!-- site metas -->
    <title></title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- site icon -->
    <link rel="icon" href="images/fevicon.png" type="image/png"/>
    <!-- bootstrap css -->
    <link rel="stylesheet" href="css/bootstrap.min.css"/>
    <!-- site css -->
    <link rel="stylesheet" href="css/style.css"/>
    <!-- responsive css -->
    <link rel="stylesheet" href="css/responsive.css"/>
    <!-- color css -->
    <link rel="stylesheet" href="css/colors.css"/>
    <!-- select bootstrap -->
    <link rel="stylesheet" href="css/bootstrap-select.css"/>
    <!-- scrollbar css -->
    <link rel="stylesheet" href="css/perfect-scrollbar.css"/>
    <!-- custom css -->
    <link rel="stylesheet" href="css/custom.css"/>
    <!-- calendar file css -->
    <link rel="stylesheet" href="js/semantic.min.css"/>

    <link rel="stylesheet" href="js/layui-v2.6.8/layui/css/layui.css" media="all">
    <script src="js/vue.js"></script>
    <script src="js/axios.min.js"></script>
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
      <![endif]-->
</head>

<body class="inner_page profile_page">
<div class="row column1">

    <div class="col-md-8">
        <div class="white_shd full margin_bottom_30">
            <div class="full graph_head">
                <div class="heading1 margin_0">
                    <h2>用户简况</h2>
                </div>
            </div>
            <div class="full price_table padding_infor_info">
                <div class="layui-form-item">
                    <h3 class="layui-form-label" style="width: auto">账号：</h3>
                    <div class="layui-input-block">
                        <label id="user_Name" style="font-size: 25px; width: 50%;" type="text" name="title"
                               lay-verify="title" autocomplete="off" class="layui-input"></label>
                    </div>
                </div>
                <!--                                        <input id="user_Name" style=" width: 50%;" type="text" name="title" lay-verify="title" autocomplete="off" placeholder="NULL" class="layui-input">-->
                <div class="row">
                    <!-- user profile section -->
                    <!-- profile image -->
                    <div class="col-lg-12">
                        <div class="full dis_flex center_text">
                            <div class="profile_img">

                                <div class="layui-upload-drag" style="padding-bottom: 0px" id="updataIMG">
                                    <div class="layui-progress-bar layui-bg-blue" lay-percent="50%"></div>
                                    <input type="file" id="file" style="display:none">
                                    <img id="imageM" class="rounded-circle" src="images/layout_img/user_img.jpg"
                                         height="180" width="180" alt="#">
                                    <div class="layui-hide" id="uploadDemoView">
                                        <canvas id="photo"></canvas>
                                    </div>
                                    <hr>
                                    <p>点击上传，或将文件拖拽到此处</p>

                                </div>
                                <div style="text-align: center;font-size: 20px">
                                    <input type="radio" name="sex" value="男" title="男" checked="">男
                                    <input type="radio" name="sex" value="女" title="女">女
                                </div>
                            </div>
                            <div class="profile_contant">
                                <div class="contact_inner">
                                    <h3>昵称：</h3><input id="user-Name" type="text" name="title" lay-verify="title"
                                                       autocomplete="off" placeholder="NULL" class="layui-input">
                                    <h3>职位&权限: </h3><label id="permissions" style="font-size: 16px;" type="text"
                                                           name="title" lay-verify="title" autocomplete="off"
                                                           class="layui-input"></label>
                                    <ul class="list-unstyled">
                                        <h3>电子邮件：</h3><input id="email" type="text" name="title" lay-verify="title"
                                                             autocomplete="off" placeholder="NULL" class="layui-input">
                                        <h3>联系电话: </h3><input id="phone" type="text" name="title" lay-verify="title"
                                                              autocomplete="off" placeholder="NULL" class="layui-input">
                                    </ul>
                                </div>

                            </div>
                        </div>
                        <!-- profile contant section -->
                        <div class="full inner_elements margin_top_30">
                            <div class="tab_style2">
                                <div class="tabbar">
                                    <nav>
                                        <div class="nav nav-tabs" id="nav-tab" role="tablist">
                                            <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab"
                                               href="#recent_activity" role="tab" aria-selected="true">最新动态</a>
                                            <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab"
                                               href="#project_worked" role="tab" aria-selected="false">项目工作</a>
                                            <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab"
                                               href="#profile_section" role="tab" aria-selected="false">简况</a>
                                        </div>
                                    </nav>
                                    <div class="tab-content" id="nav-tabContent" style="padding: 0px">
                                        <div class="tab-pane fade show active" style="height: 150px"
                                             id="recent_activity" role="tabpanel" aria-labelledby="nav-home-tab">
                                            <div class="p-2" id="app" style="overflow:scroll;height: 150px">
                                                <table style="overflow-scrolling: auto" class="layui-table"
                                                       v-if="list.name=='audit'">

                                                    <colgroup>
                                                        <col width="100">

                                                        <col>
                                                    </colgroup>
                                                    <thead>
                                                    <tr>

                                                        <th>名称</th>
                                                        <th>状态</th>
                                                        <th>提交人</th>
                                                        <th>提交时间</th>
                                                        <th>操作</th>

                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr v-for="val in list.data">
                                                        <td>{{val.name}}</td>
                                                        <td>
                                                            <span class="layui-badge" v-if="val.state==0">不通过</span>
                                                            <span class="layui-badge layui-bg-orange"
                                                                  v-else-if="val.state==1">审核中</span>
                                                            <span class="layui-badge layui-bg-green"
                                                                  v-else-if="val.state==2">审核通过</span>
                                                            <span class="layui-badge layui-bg-blue"
                                                                  v-else-if="val.state==3">已下单</span>
                                                        </td>
                                                        <td>{{val.auditname}}</td>
                                                        <td>{{val.submitTime}}</td>
                                                        <td>
                                                            <button class="layui-btn" v-on:click="StrToFunc(val)"
                                                                    id="dataT">同意
                                                            </button>
                                                            <button class="layui-btn" id="dataF">拒绝</button>
                                                        </td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>

                                        </div>
                                        <div class="tab-pane fade" id="project_worked" role="tabpanel"
                                             aria-labelledby="nav-profile-tab">

                                            <textarea id="DWork" placeholder="介绍你的工作" class="layui-textarea">Describe your work</textarea>

                                        </div>
                                        <div class="tab-pane fade" id="profile_section" role="tabpanel"
                                             aria-labelledby="nav-contact-tab">
                                            <textarea id="AYourself" placeholder="介绍你自己吧" class="layui-textarea">Tell me about yourself</textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end user profile section -->
                        <div style="text-align: center">
                            <button id="savaButton" type="button" class="layui-btn layui-btn-warm">保存</button>
                            <button id="clearButton" type="button" class="layui-btn layui-btn-normal">取消</button>
                        </div>


                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-2"></div>
    </div>
    <!-- end row -->
</div>
<!-- footer -->


<!-- jQuery -->
<script src="js/jquery.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/jquery-3.5.1.js"></script>
<script src="js/jquery-3.5.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<!-- wow animation -->
<script src="js/animate.js"></script>
<!-- select country -->
<script src="js/bootstrap-select.js"></script>
<!-- owl carousel -->
<script src="js/owl.carousel.js"></script>
<!-- chart js -->
<script src="js/Chart.min.js"></script>
<script src="js/Chart.bundle.min.js"></script>
<script src="js/utils.js"></script>
<script src="js/analyser.js"></script>
<!-- nice scrollbar -->
<script src="js/perfect-scrollbar.min.js"></script>

<!-- custom js -->
<script src="js/custom.js"></script>
<!-- calendar file css -->
<script src="js/semantic.min.js"></script>
<script src="js/layui-v2.6.8/layui/layui.js" charset="utf-8"></script>

<script>

    var username3 = document.getElementById("user-Name");
    var valdata;
    var tabUserName = document.getElementById("user_Name");
    var userpermissions = document.getElementById("permissions");
    var userEmail = document.getElementById("email");
    var userphone = document.getElementById("phone");
    var describeWork = document.getElementById("DWork");
    var aboutYourself = document.getElementById("AYourself");
    var savaButton = document.getElementById("savaButton");
    var clearButton = document.getElementById("clearButton");
    var bf = document.getElementById("dataF");
    var bt = document.getElementById("dataT");

    bf.onclick = function () {
        $.ajax({
            url: "/updata",
            type: "POST",
            data: JSON.stringify(jsonObj),
            contentType: "application/json;charset=UTF-8",
            success: function (data) {
                alert("成功")
                window.location.reload()
            },
            error: function (data) {
                alert("保存失败")

            },
            dataType: "text"
        })
    }

    // 预加载
    window.onload = function () {

        var sex = $('input[name="sex"]');

        var img2 = document.getElementById("imageM");

        $.ajax({
            url: "/index",
            type: "POST",
            contentType: "application/json;charset=UTF-8",
            success: function (data) {
                if (data.sex == "男") {
                    sex.get(0).checked = true;
                } else {
                    sex.get(1).checked = true;
                }
                if (data.avatars != null) {


                    img2.src = data.avatars;

                } else {

                    img2.src = "images/layout_img/user_img.jpg"

                }


                username3.placeholder = data.nickname
                userpermissions.innerText = toPermission(data.permissions);
                tabUserName.innerText = data.username
                userEmail.placeholder = data.userEmail
                userphone.placeholder = data.phone
                describeWork.value = data.describeWork
                aboutYourself.value = data.aboutYourself


            },
            error: function () {
                alert("请登录");
                window.location.href = "/loging"
            },
            dataType: "json"
        });


        new Vue({
            el: '#app',
            data: {
                th: [],
                use_item: 0,
                list: '',
                api_list: [
                    '/selectStateAll',
                ],
            },
            methods: {
                null_is: function () {

                },
                StrToFunc: function (open_page) {
                    this.open_page(open_page);
                },
                open_page: function (data) {

                    data.state = 2;
                    console.log(JSON.stringify(data))
                    $.ajax({
                        url: "/upaudit",
                        type: "POST",
                        data: {"data": JSON.stringify(data)},

                        success: function (data) {
                            location.reload()
                        },
                        error: function (data) {
                            alert("保存失败")

                        },
                        dataType: "text"
                    })


                },
                get: function () { // type= 获取类型
                    axios.get(this.api_list[this.use_item])
                        .then(res => {
                            this.list = res.data;
                            valdata = list.data;
                            console.log(this.list.data)

                        })
                },
                change_item: function (e, item) {
                    console.log(this.list)
                    $('#top_list li').each(function () {
                        $(this).removeClass('active');
                    })
                    $(e.target).addClass('active');
                    this.use_item = item;
                    this.get();
                }
            },
            mounted() {
                this.get();
            }
        })

    }

    // 登出
    function toPermission(id) {
        switch (id) {
            case 0:
                return "普通用户";
                break;
            case 5:
                return "管理用户";
                break;
            case 7:
                return "super管理";
                break;

        }
    }


    //文件拖拽上传
    var updateimg = document.getElementById("updataIMG")
    updateimg.onclick = function () {
        document.getElementById("file").click();

    }
    document.getElementById("file").onchange = function () {
        if (this.files.length) {
            let file = this.files[0];
            let reader = new FileReader();
            //新建 FileReader 对象
            reader.onload = function () {
                // 当 FileReader 读取文件时候，读取的结果会放在 FileReader.result 属性中
                document.getElementById("imageM").src = this.result;
                var userName = tabUserName.innerText
                var data = this.result
                $.ajax({
                    url: "/saveToImgByStr",
                    type: "POST",
                    data: {
                        "imgByte": data,
                        "username": userName
                    },

                    success: function (data) {
                    },
                    error: function () {

                    },
                });
            };
            // 设置以什么方式读取文件，这里以base64方式
            reader.readAsDataURL(file);
        }

    }


    // 信息修改保存
    function save() {
        var sex = $('input[name="sex"]:checked').val();
        var uname = tabUserName.innerText
        var nickname = username3.value
        var email = userEmail.value
        var phone = userphone.value
        if (nickname == "") {
            nickname = username3.placeholder
        }
        if (email == "") {
            email = userEmail.placeholder
        }
        if (phone == "") {
            phone = userphone.placeholder
        }
        alert("save方法执行")
        var jsonObj = {
            "username": uname,
            "nickname": nickname,
            "sex": sex,
            "userEmail": email,
            "phone": phone,
            "describeWork": describeWork.value,
            "aboutYourself": aboutYourself.value,
        };
        console.log(JSON.stringify(jsonObj))
        $.ajax({
            url: "/updata",
            type: "POST",
            data: JSON.stringify(jsonObj),
            contentType: "application/json;charset=UTF-8",
            success: function (data) {
                alert("成功")
                location.reload()
            },
            error: function (data) {
                alert("保存失败")

            },
            dataType: "text"
        })

    }

    savaButton.onclick = function () {
        save()
    }
    // 信息清空
    clearButton.onclick = function d() {
        alert("clear方法执行")
        username3.value = ""
        userEmail.value = ""
        userphone.value = ""
        describeWork.value = "Describe your work"
        aboutYourself.value = "Tell me about yourself"
    }

    function dt() {
        var data = valdata;
        data.state = 2;
        console.log(JSON.stringify(data))
        $.ajax({
            url: "/upaudit",
            type: "POST",
            data: JSON.stringify(data),
            contentType: "application/json;charset=UTF-8",
            success: function (data) {

                location.reload()

            },
            error: function (data) {
                alert("保存失败")

            },
            dataType: "text"
        })
    }


</script>
</body>

.


</html>